"use strict";(self.webpackChunkadvanced_db=self.webpackChunkadvanced_db||[]).push([[299],{29299:(e,s,t)=>{t.r(s),t.d(s,{default:()=>A});var n=t(89379),a=t(9950),o=t(73878),i=t(58522),r=t(30720),l=t(97554),c=t(12916),d=t(32741),p=t(71968),u=t(56033),h=t(86665),g=t(4112),v=t(14535),_=t(20156),m=t(22253),b=t(1201),f=t(44414);class x extends a.Component{constructor(){super(...arguments),this.state={responsive_account_ids:[],responsive_tags:[],allAccounts:{},allTags:{},alerts:[],errors:{},loading:!1},this.handleReassign=async()=>{const{t:e}=this.props;this.setState({alerts:[],errors:{},loading:!0});const{responsive_account_ids:s,allAccounts:t}=this.state,{selectedAction:a}=this.props,o=s.reduce((e,s)=>(t[s]?e.responsive_account_ids.push(s):e.responsive_tags.push(s),e),{responsive_tags:[],responsive_account_ids:[]}),i=[...new Set(o.responsive_tags.concat(this.state.responsive_tags))],r={responsive_account_ids:o.responsive_account_ids.length?o.responsive_account_ids:null,responsive_tags:i.length?i:null};try{const s=await d.A.post("/graphql",{query:p.Zr,variables:{action:r,action_id:a.id}});if(null!==s&&void 0!==s&&s.data.data){const{id:s}=this.props.selectedWorkingGroup;this.props.fetchActionPlans(s),this.props.fetchCurrentWorkingGroup(),this.props.fetchOverdueActions(),b.oR.success(e("Responsible entity updated successfully")),this.props.modalHandler(),this.setState({loading:!1})}}catch(c){if(this.setState({loading:!1}),c.message.includes("422")){var l;const e=null===(l=c.response.data.errors[0].extensions)||void 0===l?void 0:l.validation,{alerts:s,errors:t}=(0,v.Rb)({responsive_account_ids:{"should be active":{msg:"Responsive account should be invited or activated",alert:!1}}},(0,n.A)((0,n.A)({},(0,v.Od)(e,"action")),e.action));this.setState({alerts:s,errors:t})}}}}async componentDidMount(){const{selectedAction:e,selectedWorkingGroup:s}=this.props,{responsive_accounts:t=[],responsive_tags:n=[]}=e,a=await(0,_.getAllTags)(),o=await(0,_.getAllGroupAccounts)(s,t),i=(0,v.wQ)(a.map(e=>{let{title:s}=e;return{first_name:s,id:s,isTag:!0}}),"id"),r=[...t.map(e=>{let{id:s}=e;return s}),...n.map(e=>{let{title:s}=e;return s})];this.setState({responsive_account_ids:r,responsive_tags:[],allAccounts:o,allTags:i})}render(){const{responsive_account_ids:e,allAccounts:s,allTags:t,alerts:a,errors:o,loading:i}=this.state,{t:d}=this.props;return(0,f.jsx)(r.aF,{title:null,open:this.props.visible,onOk:this.props.modalHandler,onCancel:this.props.modalHandler,footer:null,zIndex:1080,children:(0,f.jsxs)("div",{children:[(0,f.jsx)(u.Q0,{children:d("Re-assign Responsible Entity")}),(0,f.jsx)(v.IM,{alerts:a}),(0,f.jsxs)(u.oi,{className:"has-messages",align:"flex-end",children:[(0,f.jsx)(l.A,{mode:"multiple",required:!0,size:"large",placeholder:d("Responsible Entity *"),value:e,style:{width:"100%",backgroundColor:"#fafbfc"},optionFilterProp:"children",allowClear:!0,showSearch:!0,onChange:e=>this.setState({responsive_account_ids:e}),className:"".concat((null===e||void 0===e?void 0:e.length)>0?"has-value":""," ").concat(o.responsive_account_ids&&"input-error"),getPopupContainer:e=>e.parentNode,menuItemSelectedIcon:(0,f.jsx)(h.h,{className:"check-icon"}),dropdownStyle:{backgroundColor:"#535263",padding:10,zIndex:1090},notFoundContent:null,defaultActiveFirstOption:!1,tagRender:function(s){const{label:t,value:n,closable:a,onClose:o}=s;return(0,f.jsx)(c.A,{closable:a,onClose:o,style:{marginRight:3,fontSize:16,padding:5},color:e.includes(n)?"blue":"default",children:t})},onSearch:e=>this.setState({tagSearch:e}),onInputKeyDown:e=>{"Enter"===e.key&&e.target.value.trim().length&&(this.setState(s=>({responsive_tags:[...new Set([...s.responsive_tags,e.target.value])],tagSearch:""})),e.target.blur(),e.target.focus())},children:Object.values((0,n.A)((0,n.A)({},s),t)).map(e=>(0,f.jsxs)(l.A.Option,{className:"select-item",value:e.id,children:[e.isTag?"#":"","".concat(e.first_name||""," ").concat(e.last_name||"")]},e.id))}),(0,f.jsx)(v.G,{name:"responsive_account_ids",errors:o})]}),(0,f.jsxs)(u.so,{className:"btn-group",margin:"30px 0 20px",children:[(0,f.jsx)(u.$n,{className:"transparent cancel",type:"button",onClick:this.props.modalHandler,children:d("Cancel")}),(0,f.jsx)(u.$$,{className:"",margin:"0px 0 0 10px",type:"button",onClick:this.handleReassign,loading:i,children:d("Re-assign")})]})]})})}}const A=(0,o.Ng)(e=>({selectedWorkingGroup:e.selectedWorkingGroup}),e=>(0,i.zH)({fetchActionPlans:g.n},e))((0,m.L)(x))}}]);
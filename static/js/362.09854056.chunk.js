"use strict";(self.webpackChunkadvanced_db=self.webpackChunkadvanced_db||[]).push([[362],{19362:(e,l,a)=>{a.r(l),a.d(l,{default:()=>$});var t,n,s,r,i,c,o,u,d,m,p,h,g,v,f,x,j,b,w=a(9950),y=a(27741),E=a(32312),N=a(99985),S=a(87094),A=a(41988),C=a(97554),k=a(16673),O=a(73878),_=a(56033),z=a(69860);const q=["title","titleId"];function F(){return F=Object.assign?Object.assign.bind():function(e){for(var l=1;l<arguments.length;l++){var a=arguments[l];for(var t in a)({}).hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e},F.apply(null,arguments)}function P(e,l){let{title:a,titleId:y}=e,E=function(e,l){if(null==e)return{};var a,t,n=function(e,l){if(null==e)return{};var a={};for(var t in e)if({}.hasOwnProperty.call(e,t)){if(-1!==l.indexOf(t))continue;a[t]=e[t]}return a}(e,l);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)a=s[t],-1===l.indexOf(a)&&{}.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}(e,q);return w.createElement("svg",F({id:"Capa_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 437.662 437.662",style:{enableBackground:"new 0 0 437.662 437.662"},xmlSpace:"preserve",ref:l,"aria-labelledby":y},E),a?w.createElement("title",{id:y},a):null,t||(t=w.createElement("g",null,w.createElement("g",null,w.createElement("path",{d:"M424.673,155.963l-53.8-44.9v-63.7c0-5.5-4.8-9.7-10.4-9.7h-78.3l-31.4-26.2c-18.5-15.3-45.3-15.3-63.8,0.1l-31.4,26.1 h-79.3c-5.5,0-10.4,4.1-10.4,9.7v64.7l-52.8,43.9c-2.2,1.9-3.5,4.8-3.4,7.7h0.2v223.9c0,27.6,22.2,50.1,49.7,50.1h318.5 c27.6,0,49.7-22.6,49.7-50.1v-223.9h0.2C428.173,160.663,426.973,157.863,424.673,155.963z M370.873,137.063l31.5,26.2l-31.5,23.4 V137.063z M199.773,26.863c11.1-9.2,27.2-9.1,38.3,0.1l12.7,10.7h-63.9L199.773,26.863z M85.873,57.663h265v143.9l-113.9,84.8 c-10.8,7.9-25.4,7.9-36.1,0l-115-85.6V57.663z M65.873,137.963v47.9l-30.5-22.7L65.873,137.963z M407.873,387.463 c0.1,16.6-13.2,30.1-29.7,30.2h-318.6c-16.5-0.1-29.8-13.6-29.7-30.1v-204l159.2,118.9c17.7,13.1,41.9,13.1,59.6,0l159.2-118.9 V387.463z"})))),n||(n=w.createElement("g",null,w.createElement("g",null,w.createElement("path",{d:"M210.873,137.663h-54c-5.5,0-10,4.5-10,10s4.5,10,10,10h54c5.5,0,10-4.5,10-10S216.373,137.663,210.873,137.663z"})))),s||(s=w.createElement("g",null,w.createElement("g",null,w.createElement("path",{d:"M280.873,187.663h-124c-5.5,0-10,4.5-10,10s4.5,10,10,10h124c5.5,0,10-4.5,10-10S286.373,187.663,280.873,187.663z"})))),r||(r=w.createElement("g",null)),i||(i=w.createElement("g",null)),c||(c=w.createElement("g",null)),o||(o=w.createElement("g",null)),u||(u=w.createElement("g",null)),d||(d=w.createElement("g",null)),m||(m=w.createElement("g",null)),p||(p=w.createElement("g",null)),h||(h=w.createElement("g",null)),g||(g=w.createElement("g",null)),v||(v=w.createElement("g",null)),f||(f=w.createElement("g",null)),x||(x=w.createElement("g",null)),j||(j=w.createElement("g",null)),b||(b=w.createElement("g",null)))}const I=w.forwardRef(P);a.p;var M=a(32741),R=a(4361),D=a(86665),B=a(14535),L=a(22253),V=a(44414);function $(e){const{visible:l,handleSuccess:a,handleCancel:t,parentRef:n,members:s}=e,r=(0,O.d4)(e=>e.auth.account),[i]=(0,L.Y)(),[c,o]=(0,w.useState)(""),u=(0,k.W6)(),[d,m]=(0,w.useState)(""),[p,h]=(0,w.useState)(""),[g,v]=(0,w.useState)(""),[f,x]=(0,w.useState)([]),[j,b]=(0,w.useState)([]),[q,F]=(0,w.useState)(null),[P,$]=(0,w.useState)("participant"),[W,X]=(0,w.useState)([]),[Y,G]=(0,w.useState)([]),[H,J]=(0,w.useState)([]),K=e=>["superuser","coordinator"].includes(r.role)||r.leader_groups.map(e=>e.id).includes(e.id),Q=s.filter(e=>e.email===c)[0];(0,w.useEffect)(()=>{X(Q?[i("A user already exists, click a button to navigate")]:[])},[Q]),(0,w.useEffect)(()=>{(async()=>{try{var e;const l=await M.A.post("/graphql",{query:R.Dg});if(null!==l&&void 0!==l&&null!==(e=l.data)&&void 0!==e&&e.data){const{organizations:e,indicator_groups:a}=l.data.data;G(e.nodes),J(a.nodes.filter(e=>"participant"===r.role?e.leaders.map(e=>e.id).includes(r.id):!!["superuser","coordinator"].includes(r.role)||void 0))}}catch(l){console.log(l)}})()},[r]);const T=(0,w.useRef)(null),U=(0,w.useRef)(null),Z=(0,w.useRef)(null),ee=(0,w.useRef)(null),le=(0,w.useRef)(null);["participant"].includes(P);return(0,V.jsx)(y.A,{title:null,visible:l,onCancel:t,footer:null,zIndex:1059,getContainer:()=>null===n||void 0===n?void 0:n.current,children:(0,V.jsx)(E.Ay,{icon:(0,V.jsx)(I,{fill:"#527BDD",width:"50"}),title:i("Invite a new user to a system"),className:"invitation-modal",extra:(0,V.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const l={first_name:d,last_name:p,comment:g,email:c,leader_groups:f,member_groups:j,role:P},t=(0,B.rM)(e=>e,l);try{var n;const e=await M.A.post("/graphql",{query:z.ED,variables:{account:t}});(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data.invite_account)&&a(c)}catch(s){422===s.response.status&&(X((0,B.sS)(s.response.data.errors[0].extensions.validation.account)),console.log((0,B.sS)(s.response.data.errors[0].extensions.validation.account)))}},children:[W.map(e=>(0,V.jsx)(N.A,{style:{marginBottom:15},message:e,type:"error",showIcon:!0},e)),(0,V.jsxs)(S.A,{gutter:[15,15],children:[Q&&(0,V.jsx)(A.A,{span:24,children:(0,V.jsx)(_.$n,{onClick:()=>u.push("?scroll_to_member=".concat(Q.id)),className:"small",style:{width:"100%"},children:i("Navigate to account")})}),(0,V.jsx)(A.A,{span:24,children:(0,V.jsxs)(_.oi,{margin:"0",children:[(0,V.jsx)(_.pd,{required:!0,type:"email",value:c,ref:T,className:"dynamic-input ".concat(c?"has-value":""," ").concat(W.email&&"input-error"),onChange:e=>o(e.target.value)}),(0,V.jsx)("label",{htmlFor:"",onClick:()=>T.current.focus(),children:i("Email")})]})}),(0,V.jsx)(A.A,{span:12,children:(0,V.jsxs)(_.oi,{margin:"0",children:[(0,V.jsx)(_.pd,{required:!0,disabled:Q,type:"text",value:d,ref:U,className:"dynamic-input ".concat(d?"has-value":""," ").concat(W.email&&"input-error"),onChange:e=>m(e.target.value)}),(0,V.jsx)("label",{htmlFor:"",onClick:()=>U.current.focus(),children:i("First name")})]})}),(0,V.jsx)(A.A,{span:12,children:(0,V.jsxs)(_.oi,{margin:"0",children:[(0,V.jsx)(_.pd,{required:!0,disabled:Q,type:"lastName",value:p,ref:Z,className:"dynamic-input ".concat(p?"has-value":""," ").concat(W.lastName&&"input-error"),onChange:e=>h(e.target.value)}),(0,V.jsx)("label",{htmlFor:"",onClick:()=>Z.current.focus(),children:i("Last name")})]})}),(0,B.oc)(r)&&(0,V.jsx)(A.A,{span:24,children:(0,V.jsxs)(_.oi,{className:"has-messages",margin:"0",children:[(0,V.jsx)(C.A,{multiple:!1,value:P,disabled:Q,onChange:e=>$(e),style:{width:"100%"},optionFilterProp:"children",className:"custom-select ".concat(P&&"has-value"),getPopupContainer:e=>e.parentNode,menuItemSelectedIcon:(0,V.jsx)(D.h,{className:"check-icon"}),dropdownStyle:{backgroundColor:"#535263",padding:10},children:Object.keys(B.nc).filter(e=>"superuser"===r.role||B.qv[r.role]>B.qv[e]||"participant"===r.role&&"participant"===e&&r.leader_groups.length).map(e=>(0,V.jsx)(C.A.Option,{className:"select-item",value:e,children:B.nc[e]},e))}),(0,V.jsx)("label",{htmlFor:"",className:"custom-select-label",children:i("Role")}),(0,V.jsx)("span",{className:"input-msg"})]})}),"participant"===P&&(0,V.jsxs)(V.Fragment,{children:["participant"!==r.role&&(0,V.jsx)(A.A,{span:24,children:(0,V.jsxs)(_.oi,{style:{margin:0},className:"has-messages working-group",children:[(0,V.jsx)(C.A,{mode:"multiple",showSearch:!0,required:!0,size:"large",placeholder:i("Assign as a leader in following group/s"),onChange:e=>x(e),value:f,ref:ee,style:{width:"100%"},className:"custom-select members ".concat(f.length>0?"has-value":""),optionFilterProp:"children",allowClear:!0,getPopupContainer:e=>e.parentNode,dropdownStyle:{backgroundColor:"#535263",padding:10},children:H.filter(K).filter(e=>!j.includes(e.id)).map(e=>(0,V.jsx)(C.A.Option,{className:"select-item",value:e.id,children:e.title},e.id))}),(0,V.jsx)("label",{htmlFor:"",className:"custom-select-label",children:i("Assign as a leader in following group/s")}),(0,V.jsx)("span",{className:"input-msg"})]})}),(0,V.jsx)(A.A,{span:24,children:(0,V.jsxs)(_.oi,{style:{margin:0},className:"has-messages working-group",children:[(0,V.jsx)(C.A,{mode:"multiple",showSearch:!0,required:!0,size:"large",placeholder:i("Assign as a member in following group/s"),onChange:e=>b(e),value:j,ref:le,style:{width:"100%"},className:"custom-select members ".concat(j.length>0?"has-value":""),optionFilterProp:"children",allowClear:!0,getPopupContainer:e=>e.parentNode,dropdownStyle:{backgroundColor:"#535263",padding:10},children:H.filter(K).filter(e=>!f.includes(e.id)).map(e=>(0,V.jsx)(C.A.Option,{className:"select-item",value:e.id,children:e.title},e.id))}),(0,V.jsx)("label",{htmlFor:"",className:"custom-select-label",children:i("Assign as a member in following group/s")}),(0,V.jsx)("span",{className:"input-msg"})]})})]}),(0,V.jsx)(A.A,{span:24,children:(0,V.jsx)(_.$$,{disabled:Q,className:"small",style:{width:"100%",height:46},children:i("Invite")})})]})]})})})}}}]);
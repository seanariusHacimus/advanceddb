"use strict";(self.webpackChunkadvanced_db=self.webpackChunkadvanced_db||[]).push([[693],{73693:(e,t,s)=>{s.r(t),s.d(t,{default:()=>b});var a=s(89379),n=s(9950),i=s(30720),l=s(38769),r=s(56033),c=s(73648),o=s(77077),h=s(32741),d=s(56225),m=s(25045),p=s.n(m),u=s(50467),f=s(14535),g=s(17634),x=s(22253),v=s(1201),j=s(44414);class y extends n.Component{constructor(){super(...arguments),this.state={name:"",date:"",comment:"",group_id:"",attachments:[],newAction:!1,errors:{},alerts:[],newAttachments:[]},this.handleInput=e=>{const{name:t,value:s}=e.target;this.setState({[t]:s,errors:(0,f.Od)(this.state.errors,t)})},this.fileSelection=()=>{let e=[];for(let t=0;t<this.fileRef.files.length;t++)e.push(this.fileRef.files[t].name);this.setState({newAttachments:e})},this.removeAttachments=async(e,t)=>{e.preventDefault();const{id:s,attachments:a}=this.state;try{const e=await h.A.post("/graphql",{query:d.Rj,variables:{meeting_minute_id:s,attachments:[t]}});null!==e&&void 0!==e&&e.data&&(this.setState({loading:!1,attachments:a.filter(e=>e.id!==t)}),this.props.fetchMeetings())}catch(i){if(i.message.includes("422")){var n;const{alerts:e,errors:t}=(0,f.Rb)(g._Q,null===(n=i.response.data.errors[0].extensions)||void 0===n?void 0:n.validation);this.setState({alerts:e,errors:t})}this.setState({loading:!1})}},this.addAttachments=async()=>{const{t:e}=this.props,{id:t}=this.state,s=this.fileRef.files;let a=new FormData;const n={query:d.Bg,variables:{meeting_minute_id:t,attachments:s.length?Array(s.length).fill(null):null}};let i={};Array(s.length).fill("").forEach((e,t)=>{i[t]=["variables.attachments.".concat(t)]}),a.append("operations",JSON.stringify(n)),a.append("map",JSON.stringify(i)),Array(s.length).fill("").forEach((e,t)=>{a.append([t],s[t])});try{const t=await h.A.post("/graphql",a);null!==t&&void 0!==t&&t.data&&(this.setState({loading:!1,attachments:t.data.data.add_attachments.filter(e=>null===e.deleted_at),msgType:"success",msg:e("The file has been uploaded"),newAttachments:[]}),this.props.fetchMeetings())}catch(r){if(r.message.includes("422")){var l;const{alerts:e,errors:t}=(0,f.Rb)(g._Q,null===(l=r.response.data.errors[0].extensions)||void 0===l?void 0:l.validation);this.setState({alerts:e,errors:t})}else this.setState({alerts:[e("The file could not be uploaded")]})}},this.submitMeetingMinute=async e=>{e.preventDefault();const{t:t}=this.props;this.setState({alerts:[],errors:{}});const{name:s,comment:n,date:i}=this.state,l={name:s,date:p()(i).utc().startOf("day").toISOString(),comment:n},r=Object.keys(l).reduce((e,t)=>{const s=l[t];return(0,a.A)((0,a.A)({},e),{},{[t]:s||null})},{});if(!r.date)return void this.setState({errors:{date:[t("is required")]}});const c={query:d.sm,variables:{meeting_minute:r,meeting_minute_id:this.state.id}};try{const e=await h.A.post("/graphql",c);this.fileRef.files.length&&await this.addAttachments(),null!==e&&void 0!==e&&e.data&&(this.props.fetchMeetings(),this.props.modalHandler(),this.props.showMessage("success",t("Meeting minute has been updated successfully")),v.oR.success(t("Meeting minute has been updated successfully")))}catch(m){if(m.message.includes("422")){var o;const e=null===(o=m.response.data.errors[0].extensions)||void 0===o?void 0:o.validation,{alerts:t,errors:s}=(0,f.Rb)(g._Q,(0,a.A)({meeting_minute_id:e.meeting_minute_id},e));this.setState({alerts:t,errors:s})}}}}componentDidMount(){this.setState((0,a.A)({},this.props.selectedItem))}render(){const{name:e,date:t,newAttachments:s,attachments:a,comment:n,errors:h,alerts:d}=this.state,m=p()(t),{t:g}=this.props;return(0,j.jsxs)(i.aF,{title:null,visible:this.props.visible,onOk:this.props.modalHandler,onCancel:this.props.modalHandler,footer:null,zIndex:1080,children:[(0,j.jsx)(r.Q0,{children:g("Edit meeting minute")}),(0,j.jsxs)("form",{id:"header",onSubmit:this.submitMeetingMinute,children:[(0,j.jsx)(f.IM,{alerts:d}),(0,j.jsxs)(i.fI,{gutter:[22],children:[(0,j.jsx)(i.fv,{xs:24,children:(0,j.jsxs)(r.oi,{children:[(0,j.jsx)(r.pd,{required:!0,type:"text",name:"name",value:e,id:"meeting-title",autoComplete:"off",ref:e=>this.nameRef=e,className:"dynamic-input grey ".concat(h.name&&"input-error"," ").concat(e?"has-value":""),onChange:this.handleInput}),(0,j.jsx)("label",{htmlFor:"",onClick:()=>this.nameRef.focus(),children:g("Meeting name *")})]})}),(0,j.jsxs)(i.fv,{span:24,children:[(0,j.jsx)("label",{htmlFor:"",onClick:()=>this.end_atRef.click(),children:g("Date *")}),(0,j.jsx)(r.oi,{children:(0,j.jsx)(l.A,{required:!0,type:"date",name:"end_at",getPopupContainer:e=>e.parentNode,value:m,placeholder:g("Start Date *"),ref:e=>this.start_atRef=e,disabledDate:e=>e<p()(),className:"custom-datepicker large grey ".concat(h.date&&"input-error"),onChange:e=>this.setState({end_at:e})})})]}),(0,j.jsx)(i.fv,{xs:24,children:(0,j.jsx)(r.oi,{children:(0,j.jsx)(o.default,{placeholder:g("comment"),className:"".concat(h.comment&&"input-error"),onChange:e=>this.setState({comment:e}),value:n})})})]}),(0,j.jsx)(r.so,{style:{flexWrap:"wrap"},children:a.map(e=>(0,j.jsxs)("div",{href:e.file.download_url,className:"file-attachment",children:[(0,j.jsx)("img",{src:u.A,alt:g("has attachment"),className:"file-attachment-icon"}),e.filename.slice(0,12)+"..."+e.filename.slice(-5),(0,j.jsx)("button",{onClick:t=>this.removeAttachments(t,e.id),className:"file-attachment-remove-btn",children:"x"})]},e.id))}),(0,j.jsx)(r.so,{style:{flexWrap:"wrap"},children:s.map((e,t)=>(0,j.jsxs)("div",{className:"file-attachment",children:[(0,j.jsx)("img",{src:u.A,alt:g("has attachment"),className:"file-attachment-icon"}),e.slice(0,12)+"..."+e.slice(-5)]},t))}),(0,j.jsx)("input",{type:"file",multiple:!0,onChange:this.fileSelection,hidden:!0,ref:e=>this.fileRef=e}),(0,j.jsxs)(r.$n,{type:"button",className:"transparent small",onClick:()=>this.fileRef.click(),children:[(0,j.jsx)("img",{src:c.A,alt:g("Upload")})," ",g("Attach file")]}),(0,j.jsxs)(r.so,{className:"btn-group",margin:"30px 0 20px",children:[(0,j.jsx)(r.$n,{className:"transparent cancel",type:"reset",onClick:this.props.modalHandler,children:g("Cancel")}),(0,j.jsx)(r.$$,{className:"",margin:"0px 0 0 10px",type:"submit",children:g("Update Meeting Minutes")})]})]})]})}}const b=(0,x.L)(y)}}]);
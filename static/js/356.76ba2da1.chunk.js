"use strict";(self.webpackChunkadvanced_db=self.webpackChunkadvanced_db||[]).push([[356],{80356:(e,t,s)=>{s.r(t),s.d(t,{default:()=>N});var a=s(89379),o=s(73878),n=s(16673),i=s(58522),r=s(30720),l=s(38769),c=s(97554),d=s(12916),u=s(32741),h=s(71968),p=s(56033),g=s(86665),m=s(4112),v=s(25045),_=s.n(v),f=s(14535),x=s(20156),b=s(22253),y=s(80703),A=s(26395),C=s(835),S=s(42630),j=s(44414);class w extends x.ActionPlanBase{constructor(){super(...arguments),this.state=(0,a.A)((0,a.A)({},x.initialState),{},{isActionNameSelected:!0}),this.handleActionNameChange=e=>{this.setState(t=>(0,a.A)((0,a.A)({},t),{},{name:e}))},this.handleActionNameClear=()=>{this.setState(e=>(0,a.A)((0,a.A)({},e),{},{name:"",pillar_number:void 0,category:void 0,sub_category:void 0,categoriesList:[],subCategoriesList:[],isActionNameSelected:!1}))},this.onSelectActionName=e=>{var t;let{pillar_number:s,category:o,sub_category:n}=e;const i=null===(t=this.props.selectedWorkingGroup)||void 0===t?void 0:t.title,r=(0,C.qd)(i,s),l=o?(0,C.K3)(i,o):[];this.setState(e=>(0,a.A)((0,a.A)({},e),{},{pillar_number:s,category:o,sub_category:n,categoriesList:r,subCategoriesList:l}))},this.onPillarChange=e=>{console.log("pillar_number",e),this.setState({pillar_number:e,category:void 0,sub_category:void 0,categoriesList:[],subCategoriesList:[],errors:(0,f.Od)((0,f.Od)((0,f.Od)(this.state.errors,"pillar_number"),"category"),"sub_category")},()=>this.loadCategories(e))},this.onCategoryChange=e=>{var t;this.setState({category:e,sub_category:void 0,subCategoriesList:(0,C.K3)(null===(t=this.props.selectedWorkingGroup)||void 0===t?void 0:t.title,e),errors:(0,f.Od)(this.state.errors,"sub_category")},()=>this.loadSubCategories(e))},this.loadCategories=e=>{var t;if(!e)return;const s=null===(t=this.props.selectedWorkingGroup)||void 0===t?void 0:t.title,a=(0,C.qd)(s,e);this.setState({categoriesList:a||[]})},this.loadSubCategories=async e=>{var t;if(!e)return;const s=null===(t=this.props.selectedWorkingGroup)||void 0===t?void 0:t.title,a=(0,C.K3)(s,e);this.setState({subCategoriesList:a||[]})},this.submitAction=async e=>{var t;e.preventDefault();const{t:s}=this.props;this.setState({alerts:[],errors:{}});const{end_at:o,name:n,description:i,responsive_account_ids:r,number:l,start_at:c,responsive_tags:d,allAccounts:p,pillar_number:g,category:m,sub_category:v}=this.state,{id:b}=this.props.selectedAction,y=r.reduce((e,t)=>(p[t]?e.responsive_account_ids.push(t):e.responsive_tags.push(t),e),{responsive_tags:[],responsive_account_ids:[]}),A=[...new Set(y.responsive_tags.concat(d))],C={end_at:_()(o).endOf("day").toISOString(),name:n,description:i||null,number:l,start_at:_()(c).startOf("day").toISOString(),responsive_account_ids:y.responsive_account_ids.length?y.responsive_account_ids:null,responsive_tags:A.length?A:null,pillar_number:g,category:m,sub_category:v},S=Boolean(null===(t=this.props.selectedWorkingGroup)||void 0===t?void 0:t.removable);if(c&&o&&n&&(null===r||void 0===r?void 0:r.length)>0&&(!!S||g&&m&&v))try{const e=await u.A.post("/graphql",{query:h.Zr,variables:{action:C,action_id:b}});null!==e&&void 0!==e&&e.data.data&&(this.setState(x.initialState),this.props.fetchCurrentWorkingGroup(),this.props.modalHandler())}catch(N){if(N.message.includes("422")){var j;const e=null===(j=N.response.data.errors[0].extensions)||void 0===j?void 0:j.validation,{alerts:t,errors:s}=(0,f.Rb)(x.errorsConfig,(0,a.A)((0,a.A)({},(0,f.Od)(e,"action")),e.action));this.setState({alerts:t,errors:s})}}else{var w;let e={};const t=["start_at","end_at","name","responsive_account_ids"];Boolean(null===(w=this.props.selectedWorkingGroup)||void 0===w?void 0:w.removable)||t.push("pillar_number","category","sub_category"),t.forEach(t=>{var o;console.log("item",t,this.state[t]),(!this.state[t]||"responsive_account_ids"===t&&0===(null===(o=this.state[t])||void 0===o?void 0:o.length))&&(e=(0,a.A)((0,a.A)({},e),{},{[t]:[s("Required field")]}))}),console.log("errors",e),this.setState({alerts:[s("Fill all required fields")],errors:e})}}}async componentDidMount(){var e;const{name:t,start_at:s,end_at:a,description:o,responsive_accounts:n,responsive_tags:i,pillar_number:r,category:l,sub_category:c,attachments:d}=this.props.selectedAction,u=await(0,x.getAllTags)(),h=await(0,x.getAllGroupAccounts)(this.props.selectedWorkingGroup,n),p=(0,f.wQ)(u.map(e=>{let{title:t}=e;return{first_name:t,id:t,isTag:!0}}),"id"),g=[...n.map(e=>{let{id:t}=e;return t}),...i.map(e=>{let{title:t}=e;return t})],m=null===(e=this.props.selectedWorkingGroup)||void 0===e?void 0:e.title,v=r?(0,C.qd)(m,r):[],_=l?(0,C.K3)(m,l):[];this.setState({name:t,start_at:s,end_at:a,description:o||"",allAccounts:h,allTags:p,responsive_account_ids:g,responsive_tags:[],pillar_number:r,category:l,sub_category:c,categoriesList:v,subCategoriesList:_,attachments:d})}render(){const{name:e,description:t,start_at:s,end_at:o,responsive_account_ids:n,allAccounts:i,alerts:u,errors:h,showDummyModal:m,isStartAtFocused:v,isEndAtFocused:x,responsive_tags:b,allTags:C,tagSearch:w,pillar_number:N,category:I,sub_category:k,categoriesList:O=[],subCategoriesList:L=[],isActionNameSelected:F}=this.state,{selectedAction:G,selectedWorkingGroup:P}=this.props,{action_boundaries:R}=G,D=R&&_()(R.start_at),E=R&&_()(R.end_at),q=_()(o),B=_()(s),{t:T}=this.props,z=null===P||void 0===P?void 0:P.title,W=Boolean(null===P||void 0===P?void 0:P.removable);return(0,j.jsx)(r.aF,{title:T("Edit the action"),open:this.props.visible&&!m,onOk:this.props.modalHandler,onCancel:this.props.modalHandler,footer:(0,j.jsxs)(r.fI,{gutter:[16],children:[(0,j.jsx)(r.fv,{span:12,children:(0,j.jsx)(p.$n,{className:"transparent cancel",type:"reset",onClick:this.props.modalHandler,children:T("Cancel")})}),(0,j.jsx)(r.fv,{span:12,children:(0,j.jsx)(p.$$,{className:"",tabIndex:"6",onClick:this.submitAction,children:T("Update the action")})})]}),zIndex:1080,children:(0,j.jsx)(p.ld,{ref:this.parentRef,onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),this.submitAction(e))},children:(0,j.jsxs)("form",{id:"edit-action-plan",onSubmit:this.submitAction,children:[(0,j.jsx)(f.IM,{alerts:u}),(0,j.jsxs)(r.fI,{gutter:[20],children:[(0,j.jsx)(r.fv,{xs:24,children:(0,j.jsxs)(p.oi,{className:"has-messages",margin:"8px",align:"flex-end",children:[(0,j.jsx)(A.A,{onChange:this.handleActionNameChange,onSelect:this.onSelectActionName,value:e,topicName:z,placeholder:"Action name*",onClear:this.handleActionNameClear,existingActions:this.props.actions.filter(e=>e.id!==this.props.selectedAction.id).map(e=>e.name)}),(0,j.jsx)("label",{htmlFor:"",onClick:()=>this.nameRef.focus(),children:T("Action name *")}),(0,j.jsx)(f.G,{name:"name",errors:h})]})}),!W&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(r.fv,{xs:24,children:(0,j.jsxs)(p.oi,{className:"has-messages",margin:"8px",align:"flex-end",children:[(0,j.jsxs)(c.A,{style:{width:"100%"},size:"large",placeholder:T("Pillar number *"),value:N,allowClear:!0,onChange:this.onPillarChange,disabled:F,filterOption:(e,t)=>t.children.toLowerCase().includes(e.toLowerCase()),className:"custom-select ".concat(N?"has-value":""," ").concat(h.pillar_number?"input-error":""),getPopupContainer:e=>e.parentNode,dropdownStyle:{zIndex:1090},children:[(0,j.jsx)(c.A.Option,{value:"I",children:"Pillar I"},1),(0,j.jsx)(c.A.Option,{value:"II",children:"Pillar II"},2),(0,j.jsx)(c.A.Option,{value:"III",children:"Pillar III"},3)]}),(0,j.jsx)(f.G,{name:"pillar_number",errors:h})]})},"pillar_number"),(0,j.jsx)(r.fv,{xs:24,children:(0,j.jsxs)(p.oi,{className:"has-messages",margin:"8px",align:"flex-end",children:[(0,j.jsx)(c.A,{showSearch:!0,style:{width:"100%"},size:"large",placeholder:T("Category *"),value:I,onChange:this.onCategoryChange,disabled:!N||F,allowClear:!0,filterOption:(e,t)=>t.children.toLowerCase().includes(e.toLowerCase()),className:"custom-select ".concat(I?"has-value":""," ").concat(h.category?"input-error":""),getPopupContainer:e=>e.parentNode,dropdownStyle:{zIndex:1090},children:null===O||void 0===O?void 0:O.map(e=>(0,j.jsx)(c.A.Option,{value:e.value,children:e.value},e.value))}),(0,j.jsx)(f.G,{name:"category",errors:h})]})},"category"),(0,j.jsx)(r.fv,{xs:24,children:(0,j.jsxs)(p.oi,{className:"has-messages",margin:"8px",align:"flex-end",children:[(0,j.jsx)(c.A,{showSearch:!0,style:{width:"100%"},placeholder:T("Sub-category *"),value:k,onChange:e=>this.setState({sub_category:e,errors:(0,f.Od)(this.state.errors,"sub_category")}),disabled:!I||F,filterOption:(e,t)=>t.children.toLowerCase().includes(e.toLowerCase()),className:"custom-select  ".concat(k?"has-value":""," ").concat(h.sub_category?"input-error":""),optionFilterProp:"children",allowClear:!0,multiple:!1,getPopupContainer:e=>e.parentNode,dropdownStyle:{backgroundColor:"#535263",padding:10,zIndex:1090},size:"large",children:null===L||void 0===L?void 0:L.map(e=>(0,j.jsx)(c.A.Option,{value:e.value,children:e.value},e.value))}),(0,j.jsx)(f.G,{name:"sub_category",errors:h})]})},"sub_category")]}),(0,j.jsx)(r.fv,{xs:24,children:(0,j.jsxs)(r.fI,{gutter:[22],children:[(0,j.jsx)(r.fv,{span:12,children:(0,j.jsxs)(p.oi,{className:"has-messages",margin:"8px",align:"flex-end",children:[(0,j.jsx)(l.A,{required:!0,type:"date",tabIndex:"2",name:"start_at",allowClear:!1,value:B,placeholder:T("Start Date *"),ref:e=>this.start_atRef=e,open:v,getPopupContainer:e=>e.parentNode,onFocus:()=>this.setState({isStartAtFocused:!0}),onBlur:()=>this.setState({isStartAtFocused:!1}),onSelect:()=>this.setState({isStartAtFocused:!1}),disabledDate:e=>D&&e>D||e>q,className:"custom-datepicker large grey ".concat(h.start_at&&"input-error"," ").concat(s?"has-value":""),onChange:e=>this.setState({start_at:e.startOf("day")})}),(0,j.jsx)(f.G,{name:"start_at",errors:h})]})}),(0,j.jsx)(r.fv,{span:12,children:(0,j.jsxs)(p.oi,{className:"has-messages",margin:"8px",align:"flex-end",children:[(0,j.jsx)(l.A,{required:!0,type:"date",name:"end_at",tabIndex:"3",allowClear:!1,getPopupContainer:e=>e.parentNode,value:q,open:x,placeholder:T("End Date *"),ref:e=>this.end_atRef=e,onFocus:()=>this.setState({isEndAtFocused:!0}),onBlur:()=>this.setState({isEndAtFocused:!1}),onSelect:()=>this.setState({isEndAtFocused:!1}),disabledDate:e=>E&&e<E||e<B,className:"custom-datepicker large grey ".concat(h.end_at&&"input-error"," ").concat(s?"has-value":""),onChange:e=>this.setState({end_at:e.endOf("day")})}),(0,j.jsx)(f.G,{name:"end_at",errors:h})]})})]})}),(0,j.jsx)(r.fv,{span:24,children:(0,j.jsxs)(p.oi,{className:"has-messages",margin:"8px",align:"flex-end",children:[(0,j.jsx)(c.A,{mode:"multiple",required:!0,size:"large",tabIndex:"5",placeholder:T("Assign to*"),value:[...new Set(n.concat(b))],onSearch:e=>this.setState({tagSearch:e}),style:{width:"100%",backgroundColor:"#fafbfc"},optionFilterProp:"children",allowClear:!0,showSearch:!0,onChange:e=>this.setState({responsive_account_ids:e}),className:"".concat((null===n||void 0===n?void 0:n.length)>0?"has-value":""," ").concat(h.responsive_account_ids&&"input-error"),getPopupContainer:e=>e.parentNode,menuItemSelectedIcon:(0,j.jsx)(g.h,{className:"check-icon"}),dropdownStyle:{backgroundColor:"#535263",padding:10,zIndex:1090},notFoundContent:null,defaultActiveFirstOption:!1,tagRender:function(e){const{label:t,value:s,closable:a,onClose:o}=e;return(0,j.jsx)(d.A,{closable:a,onClose:o,style:{marginRight:3,fontSize:16,padding:5},color:b.includes(s)?"blue":"default",children:t})},ref:e=>this.entityRef=e,onDeselect:e=>this.handleRemoveTag(e),onInputKeyDown:e=>{"Enter"===e.key&&w.trim().length&&(this.setState(e=>({responsive_tags:[...new Set([...e.responsive_tags,w])],tagSearch:""})),this.entityRef.blur(),this.entityRef.focus())},children:Object.values((0,a.A)((0,a.A)({},i),C)).map(e=>(0,j.jsxs)(c.A.Option,{className:"select-item",value:e.id,children:[e.isTag?"#":"","".concat(e.first_name||""," ").concat(e.last_name||"")]},e.id))}),(0,j.jsx)(f.G,{name:"responsive_account_ids",errors:h})]})},"responsive_accounts"),(0,j.jsx)(r.fv,{span:24,children:(0,j.jsxs)(p.oi,{className:"has-messages",margin:"8px",align:"flex-start",children:[(0,j.jsx)("label",{htmlFor:"",onClick:()=>{},children:T("Description")}),(0,j.jsx)(S.K,{height:150,value:t||"",onChange:e=>this.setState({description:e,errors:(0,f.Od)(this.state.errors,"description")}),className:"".concat(h.description&&"input-error")}),(0,j.jsx)(f.G,{name:"description",errors:h})]})}),(0,j.jsx)(r.fv,{span:24,children:(0,j.jsx)(y.A,{id:G.id,attachments:G.attachments,setAttachments:e=>this.setState({files:e})})})]})]})})})}}const N=(0,o.Ng)(e=>({selectedWorkingGroup:e.selectedWorkingGroup,actions:e.actions.data}),e=>(0,i.zH)({fetchActionPlans:m.n},e))((0,n.y)((0,b.L)(w)))},80703:(e,t,s)=>{s.d(t,{A:()=>f});var a=s(80045),o=s(89379),n=s(9950),i=s(75025),r=s(1201),l=s(20307),c=(s(73878),s(22253)),d=s(4695),u=s.n(d),h=s(71968),p=s(32741),g=s(56033),m=s(44414);const v=["originFileObj"],_=e=>e.reduce((e,t)=>(null===t.deleted_at&&e.push((0,o.A)((0,o.A)({},t),{},{uid:"".concat(t.id),status:"done",url:t.file.download_url,name:t.filename})),e),[]);const f=function(e){let{setAttachments:t,id:s,attachments:d=[],accept:f="image/png, image/jpeg, .doc, .docx, .pdf",isDisabled:x=!1}=e;const[b]=(0,c.Y)(),[y,A]=(0,n.useState)(null),[C,S]=(0,n.useState)({attachments:[],fileList:_(d)}),j=async e=>{try{const t=await p.A.post("/graphql",{query:h.Rj,variables:{action_id:s,attachments:[e]}});if(null!==t&&void 0!==t&&t.data){console.log(t.data.data);const s=C.fileList.filter(t=>t.id!==e);console.log(s),S(e=>(0,o.A)((0,o.A)({},e),{},{fileList:s}))}}catch(t){console.log(t),A(b("The file could not be uploaded")),r.oR.error(b("The file could not be uploaded"))}},w=(0,m.jsxs)(g.$$,{type:"button",className:"mt-4 default focusable",style:{padding:"8px 40px",height:41},tabIndex:"0",disabled:x,children:[b("Upload"),(0,m.jsx)(l.A,{size:20,style:{marginLeft:5,verticalAlign:"middle"}})]}),{fileList:N}=C;return(0,n.useEffect)(()=>{t(C.attachments)},[C.attachments]),(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(i.A,{action:()=>console.log("test"),listType:"",fileList:N,onPreview:void 0,onChange:async e=>{const t=e.file,{originFileObj:n}=t;(0,a.A)(t,v);let i=new FormData;const l={query:h.Bg,variables:{action_id:s,attachments:[null]}};let c={};Array(1).fill("").forEach((e,t)=>{c[t]=["variables.attachments.".concat(t)]}),i.append("operations",JSON.stringify(l)),i.append("map",JSON.stringify(c)),Array(1).fill("").forEach((e,t)=>{i.append([t],n)});try{const{data:e}=await p.A.post("/graphql",i);e&&(console.log(e),S(t=>(0,o.A)((0,o.A)({},t),{},{fileList:_(e.data.add_attachments)})))}catch(d){console.log(d),A(b("The file could not be uploaded")),r.oR.error(b("The file could not be uploaded"))}},accept:f,onRemove:e=>(u().fire({confirmButtonText:b("Yes"),cancelButtonText:b("No"),text:b("Do you want to delete this file?"),cancelButtonColor:"#E7E9EB",confirmButtonColor:"#e70563",showCancelButton:!0,customClass:"swal-danger"}).then(async t=>{let{value:s}=t;if(!s)return!1;console.log(e),j(e.uid)}),!1),showUploadList:{showDownloadIcon:!0},data:e=>({name:e.name,content_type:e.type}),disabled:x,children:w})})}}}]);
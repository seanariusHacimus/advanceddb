"use strict";(self.webpackChunkadvanced_db=self.webpackChunkadvanced_db||[]).push([[939],{49939:(e,t,a)=>{a.r(t),a.d(t,{ReformBase:()=>C,default:()=>v,errorsConfig:()=>y,initialState:()=>j,nullableFields:()=>b});var s=a(89379),i=a(9950),o=a(38769),r=a(27741),n=a(97554),l=a(77077),d=a(56033),c=a(79893),p=a(61456),u=a(12519),h=a(25045),m=a.n(h),g=a(32741),_=a(14535),f=a(22253),x=a(44414);const y={type_of_update:(0,s.A)({},_.t2),date_of_entry:{},group_id:(0,s.A)((0,s.A)({},_.t2),{},{"should be existing":{msg:"should exist",alert:"Working group is deleted"}}),geo_impact:{},sub_index_impacted:(0,s.A)({},_.t2),legal_basis:{},suggested_data_modification:{},description:{}},b=["geo_impact","description","suggested_date","suggested_data_modification","date_of_entry","legal_basis"],j={creator:"id",date_of_entry:"",description:"",geo_impact:"",group_id:"",groups:[],legal_basis:"",sub_index_impacted:"",suggested_data:"",suggested_data_modification:"",type_of_update:"",visible:!1,errors:{},alerts:[]};class C extends i.Component{constructor(){super(...arguments),this.state=j,this.handleInput=e=>{const{name:t,value:a}=e.target;this.setState({[t]:a,errors:(0,_.Od)(this.state.errors,t)})},this.handleTextArea=e=>{this.setState({description:e,errors:(0,_.Od)(this.state.errors,"description")})}}}const v=(0,f.L)(class extends C{constructor(){super(...arguments),this.handleSubmit=async e=>{e.preventDefault();const{t:t}=this.props;let a=(0,_.Up)(this.state,["type_of_update","date_of_entry","group_id","geo_impact","sub_index_impacted","legal_basis","suggested_data_modification","description"]);a=Object.keys(a).reduce((e,t)=>{const i=a[t];return(0,s.A)((0,s.A)({},e),{},{[t]:b.includes(t)?i||null:i||""})},{});const i=(0,s.A)((0,s.A)({},a),{},{date_of_entry:m()(a.date_of_entry).utc().endOf("day").toISOString()});if(a.group_id)try{const e=await g.A.post("/graphql",{query:u.jl,variables:{reform:i,attachments:[]}});null!==e&&void 0!==e&&e.data.data&&(this.props.fetchReforms(),this.props.showMessage("success",t("The reform has been created successfully!")),this.props.hideModal(),this.setState(j))}catch(n){if(n.message.includes("422")){var o,r;const{alerts:e,errors:t}=(0,_.Rb)(y,null===(o=n.response.data.errors[0].extensions)||void 0===o||null===(r=o.validation)||void 0===r?void 0:r.reform);this.setState({alerts:e,errors:t})}}else{const{alerts:e,errors:t}=(0,_.Rb)(y,{group_id:["cannot be empty"]});this.setState({alerts:e,errors:t})}}}async componentDidMount(){try{const e=await g.A.post("/graphql",{query:p.Cw,variables:{filter:{},order:{key:"title",direction:"asc"}}});if(null!==e&&void 0!==e&&e.data){const{indicator_groups:t}=e.data.data;this.setState({groups:t.nodes,loading:!1})}}catch(e){console.log(e)}}render(){const{t:e}=this.props,{modalVisible:t,hideModal:a}=this.props,{type_of_update:s,date_of_entry:i,geo_impact:p,sub_index_impacted:u,legal_basis:h,groups:g,description:f,alerts:y,errors:b,group_id:j,suggested_data_modification:C}=this.state;return(0,x.jsx)(c.o,{ref:e=>this.addParentRef=e,children:(0,x.jsxs)(r.A,{title:null,visible:t,onCancel:a,footer:null,zIndex:1080,width:"100%",style:{maxWidth:600},children:[(0,x.jsx)("h2",{className:"title",children:e("New reform update")}),(0,x.jsxs)("form",{action:"",children:[(0,x.jsx)(_.IM,{alerts:y}),(0,x.jsxs)(d.oi,{className:"has-messages",align:"flex-end",children:[(0,x.jsxs)(n.A,{showSearch:!0,size:"large",name:"type_of_update",value:s||null,multiple:!1,id:"reform-title",ref:e=>this.type_of_updateRef=e,placeholder:e("Type of data update"),onChange:e=>this.setState({type_of_update:e,errors:(0,_.Od)(b,"type_of_update")}),style:{width:"100%"},optionFilterProp:"children",className:"custom-select narrow no-padding grey ".concat(b.type_of_update&&"input-error"," ").concat(s?"has-value":""),allowClear:!0,getPopupContainer:e=>e.parentNode,dropdownStyle:{backgroundColor:"#535263",padding:10},children:[(0,x.jsx)(n.A.Option,{className:"select-item",value:"Data Correction",children:e("Data Correction")},"Data Correction"),(0,x.jsx)(n.A.Option,{className:"select-item",value:"Reform",children:e("Reform")},"Reform")]}),(0,x.jsx)("label",{htmlFor:"",onClick:()=>this.type_of_updateRef.focus(),children:e("Type of data update")}),(0,x.jsx)(_.G,{name:"type_of_update",errors:b})]}),(0,x.jsxs)(d.oi,{className:"has-messages",align:"flex-end",children:[(0,x.jsx)(n.A,{showSearch:!0,size:"large",name:"group_id",value:j||null,multiple:!1,placeholder:e("Indicator impacted"),onChange:e=>this.setState({group_id:e,errors:(0,_.Od)(b,"group_id")}),style:{width:"100%"},optionFilterProp:"children",className:"custom-select narrow no-padding grey ".concat(b.group_id&&"input-error"," ").concat(j?"has-value":""),allowClear:!0,getPopupContainer:e=>e.parentNode,dropdownStyle:{backgroundColor:"#535263",padding:10},children:g.map(e=>(0,x.jsx)(n.A.Option,{className:"select-item",value:e.id,children:e.title},e.title))}),(0,x.jsx)("label",{htmlFor:"",className:"custom-select-label",children:e("Indicator impacted")}),(0,x.jsx)(_.G,{name:"group_id",errors:b})]}),(0,x.jsxs)(d.oi,{className:"has-messages",align:"flex-end",children:[(0,x.jsx)(d.pd,{type:"text",id:"geo-impact",name:"geo_impact",autoComplete:"off",value:p,ref:e=>this.geo_impactRef=e,className:"dynamic-input grey ".concat(b.geo_impact&&"input-error"," ").concat(p?"has-value":""),onChange:this.handleInput}),(0,x.jsx)("label",{htmlFor:"",onClick:()=>this.geo_impactRef.focus(),children:e("Geographic impact")}),(0,x.jsx)(_.G,{name:"geo_impact",errors:b})]}),(0,x.jsxs)("div",{fd:"column",children:[(0,x.jsx)("p",{className:"text-left",style:{width:"100%"},children:(0,x.jsx)("label",{htmlFor:"",children:e("Description of the data update")})}),(0,x.jsx)(l.default,{onChange:e=>{this.setState({description:e})},value:f,placeholder:e("Description of the data update"),maxChars:2500})]}),(0,x.jsxs)(d.oi,{className:"has-messages",align:"flex-end",children:[(0,x.jsx)(d.pd,{required:!0,type:"text",autoComplete:"off",id:"sub-index-impacted",name:"sub_index_impacted",value:u||"",ref:e=>this.sub_index_impactedRef=e,className:"dynamic-input grey ".concat(b.sub_index_impacted&&"input-error"," ").concat(u?"has-value":""),onChange:this.handleInput}),(0,x.jsx)("label",{htmlFor:"",onClick:()=>this.sub_index_impactedRef.focus(),children:e("Sub-index or question impacted")}),(0,x.jsx)(_.G,{name:"sub_index_impacted",errors:b})]}),(0,x.jsxs)(d.oi,{className:"has-messages",align:"flex-end",children:[(0,x.jsx)(d.pd,{autoComplete:"off",id:"suggested_data_modification",name:"suggested_data_modification",value:C,ref:e=>this.suggested_data_modificationRef=e,className:"dynamic-input grey ".concat(b.suggested_data_modification&&"input-error"," ").concat(C?"has-value":""),onChange:this.handleInput}),(0,x.jsx)("label",{htmlFor:"",onClick:()=>this.suggested_data_modificationRef.focus(),children:e("Suggested data modification")}),(0,x.jsx)(_.G,{name:"suggested_data_modification",errors:b})]}),(0,x.jsxs)(d.oi,{className:"has-messages",align:"flex-end",children:[(0,x.jsx)(o.A,{required:!0,type:"date",name:"date_of_entry",placeholder:e("Date of entry into force (if applicable):"),getPopupContainer:e=>e.parentNode,value:i?m()(i):i,ref:e=>this.date_of_entryRef=e,className:"custom-datepicker large grey ".concat(b.date_of_entry&&"input-error"," ").concat(i?"has-value":""),onChange:e=>this.setState({date_of_entry:e})}),(0,x.jsx)(_.G,{name:"date_of_entry",errors:b})]}),(0,x.jsxs)(d.oi,{className:"has-messages",align:"flex-end",children:[(0,x.jsx)(d.pd,{required:!0,type:"text",id:"legal_basis",autoComplete:"off",name:"legal_basis",value:h,ref:e=>this.legal_basisRef=e,className:"dynamic-input grey ".concat(b.legal_basis&&"input-error"," ").concat(h?"has-value":""),onChange:this.handleInput}),(0,x.jsxs)("label",{htmlFor:"",onClick:()=>this.legal_basisRef.focus(),children:[e("Legal basis (if applicable)"),":"]}),(0,x.jsx)(_.G,{name:"legal_basis",errors:b})]}),(0,x.jsxs)(d.so,{children:[(0,x.jsx)(d.$n,{type:"reset",onClick:a,style:{height:51,marginRight:12},children:e("Cancel")}),(0,x.jsx)(d.$$,{onClick:this.handleSubmit,children:e("Apply")})]})]})]})})}})}}]);
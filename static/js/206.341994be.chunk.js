"use strict";(self.webpackChunkadvanced_db=self.webpackChunkadvanced_db||[]).push([[206],{94206:(e,s,t)=>{t.r(s),t.d(s,{default:()=>k});var a=t(89379),i=t(9950),l=t(58522),r=t(73878),n=t(99985),o=t(27741),d=t(97554),c=t(76580),h=t(56033),p=t(61456),u=t(55360),m=t(86665),g=t(32741),b=t(6560),v=t(22253),x=t(44414);class f extends i.Component{constructor(){super(...arguments),this.state={visible:!1,group:{title:"",members:[],leaders:[]},allAccounts:[],errorMsg:"",titleError:""},this.fetchMembers=async()=>{try{const e=await g.A.post("/graphql",{query:u.J5,variables:{pagination:{size:-1},filter:{role:"participant"}}});if(null!==e&&void 0!==e&&e.data){const{accounts:s}=e.data.data;this.setState({allAccounts:s.nodes})}}catch(e){console.log(e)}},this.inputHandler=e=>{this.setState({group:(0,a.A)((0,a.A)({},this.state.group),{},{[e.target.name]:e.target.value})})},this.updateWorkingGroup=async()=>{const{group:e}=this.state,{t:s}=this.props,{title:t,id:a,leaders:i,members:l}=e,r={query:p._6,variables:{group:{title:t},leaders:i,members:l,id:a}};try{const e=await g.A.post("/graphql",r);null!==e&&void 0!==e&&e.data&&(this.setState({visible:!1}),this.props.fetchWorkingGroupsAction(),this.props.modalHandler())}catch(h){var n,o;const{extensions:e="",message:t=""}=null===(n=h.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.errors[0];var d,c;if(console.log(h.response),e.validation)this.setState({titleError:e.validation.group.title.includes("should not conflict")?s("Group with this title is already exist"):e.validation.group.title,membersError:(null===(d=this.state.members)||void 0===d?void 0:d.length)&&s("Selected users can not be assigned"),leadersError:(null===(c=this.state.leaders)||void 0===c?void 0:c.length)&&s("Selected users can not be assigned")});else this.setState({errorMsg:t})}}}componentDidMount(){const{selectedItem:e}=this.props;this.setState({group:(0,a.A)((0,a.A)({},e),{},{leaders:e.leaders.map(e=>e.id),members:e.members.map(e=>e.id)})}),this.fetchMembers()}render(){const{errorMsg:e,allAccounts:s,group:t}=this.state,{title:a,leaders:i,members:l}=t,{t:r}=this.props;return(0,x.jsx)(c.x,{children:(0,x.jsxs)(o.A,{title:null,visible:this.props.visible,onOk:this.props.modalHandler,onCancel:this.props.modalHandler,footer:null,zIndex:1080,children:[(0,x.jsx)("h2",{style:j.title,children:r("Edit working group")}),e&&(0,x.jsx)(n.A,{message:e,type:"error",showIcon:!0}),(0,x.jsxs)(h.oi,{className:"has-messages",children:[(0,x.jsx)(h.pd,{required:!0,type:"text",name:"title",value:a,ref:e=>this.titleRef=e,autoComplete:"new-email",id:"WG-title",className:"dynamic-input ".concat(a?"has-value":""),onChange:this.inputHandler}),(0,x.jsx)("label",{htmlFor:"",onClick:()=>this.titleRef.focus(),children:r("Working group name")}),(0,x.jsx)("span",{className:"input-msg",children:this.state.titleError})]}),(0,x.jsxs)(h.oi,{className:"has-messages working-group",children:[(0,x.jsx)(d.A,{required:!0,allowClear:!0,showSearch:!0,size:"large",mode:"multiple",value:i,style:{width:"100%"},optionFilterProp:"children",placeholder:r("Group leaders"),ref:e=>this.leadersRef=e,className:"custom-select members ".concat(i.length>0?"has-value":""),onChange:e=>this.inputHandler({target:{name:"leaders",value:e}}),getPopupContainer:e=>e.parentNode,menuItemSelectedIcon:(0,x.jsx)(m.h,{className:"check-icon"}),dropdownStyle:{backgroundColor:"#535263",padding:10},children:s.filter(e=>!l.includes(e.id)).map(e=>(0,x.jsx)(d.A.Option,{className:"select-item",value:e.id,disabled:["disabled","denied","pending","unconfirmed","invite_expired"].includes(e.status)&&!i.includes(e.id),children:"".concat(e.first_name," ").concat(e.last_name)},e.id))}),(0,x.jsx)("label",{htmlFor:"",className:"custom-select-label",children:r("Group leaders")}),(0,x.jsx)("span",{className:"input-msg",children:this.state.leadersError})]}),(0,x.jsxs)(h.oi,{className:"has-messages working-group",children:[(0,x.jsx)(d.A,{required:!0,allowClear:!0,showSearch:!0,size:"large",mode:"multiple",value:l,style:{width:"100%"},optionFilterProp:"children",placeholder:r("Group members"),ref:e=>this.membersRef=e,className:"custom-select members ".concat(l.length>0?"has-value":""),onChange:e=>this.inputHandler({target:{name:"members",value:e}}),getPopupContainer:e=>e.parentNode,menuItemSelectedIcon:(0,x.jsx)(m.h,{className:"check-icon"}),dropdownStyle:{backgroundColor:"#535263",padding:10},children:s.filter(e=>!i.includes(e.id)).map(e=>(0,x.jsx)(d.A.Option,{className:"select-item",value:e.id,disabled:["disabled","denied","pending","unconfirmed","invite_expired"].includes(e.status)&&!l.includes(e.id),children:"".concat(e.first_name," ").concat(e.last_name)},e.id))}),(0,x.jsx)("label",{htmlFor:"",className:"custom-select-label",children:r("Group members")}),(0,x.jsx)("span",{className:"input-msg",children:this.state.leadersError})]}),(0,x.jsxs)(h.so,{children:[(0,x.jsx)(h.$n,{type:"reset",onClick:this.props.modalHandler,style:{height:51,marginRight:12},children:r("Cancel")}),(0,x.jsx)(h.$$,{onClick:this.updateWorkingGroup,children:r("Apply")})]})]})})}}const j={title:{fontSize:24,fontWeight:400,lineHeight:"30px",color:"#252A32"}},k=(0,r.Ng)(e=>({user:e.auth,indicators:e.workingGroups.data}),e=>(0,l.zH)({fetchWorkingGroupsAction:b.w$},e))((0,v.L)(f))}}]);